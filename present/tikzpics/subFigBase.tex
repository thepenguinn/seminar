\colorlet{bgcol}{white}
\colorlet{fgcol}{black}

\tikzset{

    figureTikzPicStyle/.style = {
        %> = stealth,
        %shorten > = 0.5cm,
        %shorten < = 0.5cm,
    },

    absImpModule/.style = {
        ultra thick,
        rectangle,
        draw = fgcol,
        rounded corners = 0.5cm,
        inner sep = 0.5cm,
        outer sep = 0.5cm,
        text width = 2.5cm,
        minimum height = 1.8cm,
        text centered,
    },

    absNotImpModule/.style = {
        gray,
        dashdotted,
        ultra thick,
        rectangle,
        draw = gray,
        rounded corners = 0.5cm,
        inner sep = 0.5cm,
        outer sep = 0.5cm,
        text width = 2.5cm,
        text centered,
    },

    absOuterModule/.style = {
        black,
        inner sep = 0cm,
        outer sep = 0.75cm,
        ultra thick,
    },

    absInnerLabel/.style = {
        inner sep = 1cm,
        outer sep = 0.5cm,
    },

    absOuterLabel/.style = {
        black,
    },

    %% DUInterConnectStart
    DUInterConnectFromNoneToNone/.style = {
    },
    DUInterConnectFromNoneToOpen/.style = {
        decoration={
            markings,
            mark={
                at position 1
                with {
                    \draw [fill = bgcol] circle [radius = #1];
                },
            },
        },
        postaction=decorate,
    }, DUInterConnectFromNoneToOpen/.default = 4pt,

    DUInterConnectFromNoneToFill/.style = {
        decoration={
            markings,
            mark={
                at position 1
                with {
                    \filldraw [] circle [radius = #1];
                },
            },
        },
        postaction=decorate,
    }, DUInterConnectFromNoneToFill/.default = 4pt,

    %%
    DUInterConnectFromOpenToNone/.style = {
        decoration={
            markings,
            mark={
                at position 0
                with {
                    \draw [fill = bgcol] circle [radius = #1];
                },
            },
        },
        postaction=decorate,
    }, DUInterConnectFromOpenToNone/.default = 4pt,

    DUInterConnectFromOpenToOpen/.style = {
        decoration={
            markings,
            mark={
                at position 0
                with {
                    \draw [fill = bgcol] circle [radius = #1];
                },
            },
            mark={
                at position 1
                with {
                    \draw [fill = bgcol] circle [radius = #1];
                },
            },
        },
        postaction=decorate,
    }, DUInterConnectFromOpenToOpen/.default = 4pt,

    DUInterConnectFromOpenToFill/.style = {
        decoration={
            markings,
            mark={
                at position 0
                with {
                    \draw [fill = bgcol] circle [radius = #1];
                },
            },
            mark={
                at position 1
                with {
                    \filldraw [] circle [radius = #1];
                },
            },
        },
        postaction=decorate,
    }, DUInterConnectFromOpenToFill/.default = 4pt,
    %%

    DUInterConnectFromFillToNone/.style = {
        decoration={
            markings,
            mark={
                at position 0
                with {
                    \filldraw [] circle [radius = #1];
                },
            },
        },
        postaction=decorate,
    }, DUInterConnectFromFillToNone/.default = 4pt,

    DUInterConnectFromFillToOpen/.style = {
        decoration={
            markings,
            mark={
                at position 0
                with {
                    \filldraw [] circle [radius = #1];
                },
            },
            mark={
                at position 1
                with {
                    \draw [fill = bgcol] circle [radius = #1];
                },
            },
        },
        postaction=decorate,
    }, DUInterConnectFromFillToOpen/.default = 4pt,

    DUInterConnectFromFillToFill/.style = {
        decoration={
            markings,
            mark={
                at position 0
                with {
                    \filldraw [] circle [radius = #1];
                },
            },
            mark={
                at position 1
                with {
                    \filldraw [] circle [radius = #1];
                },
            },
        },
        postaction=decorate,
    }, DUInterConnectFromFillToFill/.default = 4pt,
    %% DUInterConnectEnd

    innerEnclosure/.style = {
        ultra thick,
        % dashdotted,
        rectangle,
        draw = black,
        gray,
        rounded corners = 1cm,
        inner sep = 0cm,
        outer sep = 1cm,
    },

    %pics/innerEnclosure/.style args={#1/#2}{
    %    code = {
    %        \draw [
    %            gray,
    %            rounded corners = 1cm,
    %            outer sep = 1cm,
    %        ] (#1) rectangle (#2) ;
    %    },
    %},

    innerConnect/.style = {
        rounded corners = 0.5cm,
        gray,
        very thick,
        DUInterConnectFromOpenToOpen,
    },

    outerConnectTo/.style = {
        black,
        very thick,
        DUInterConnectFromFillToOpen,
    },

    outerConnectFrom/.style = {
        black,
        very thick,
        DUInterConnectFromOpenToFill,
    },

}

%% <name> <corner> <oppCorner>
\newcommand\innerEnclosureNode[3] {
    \draw
    let \p{TEMPDIMA} = ($(#2)-(#3)$),
    \n{TEMPDIMX} = {veclen(\x{TEMPDIMA}, 0)},
    \n{TEMPDIMY} = {veclen(0, \y{TEMPDIMA})}
    in
    ($(#2)!0.50!(#3)$)
    node (#1) [
        innerEnclosure,
        minimum height = \n{TEMPDIMY},
        minimum width = \n{TEMPDIMX},
        anchor = center,
    ] {}
    ;
}

\subtikzpicturedef{subFigBase} {
    origin%
} {
    \draw (#1-start) coordinate (#1-origin);
}

\subtikzpictureactivate{subFigBase}
